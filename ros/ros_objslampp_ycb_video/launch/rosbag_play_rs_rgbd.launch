<launch>

  <arg name="PLAY_ROSBAG" default="true" />
  <arg name="GUI" default="true" />

  <group if="$(arg PLAY_ROSBAG)">
    <param name="/use_sim_time" value="true" />
    <node name="rosbag_play_rs_rgbd"
          pkg="ros_objslampp_ycb_video" type="rosbag_play_rs_rgbd.py"
          clear_params="true"
          args="--clock --loop"
          output="screen">
    </node>
  </group>

  <group ns="/camera/color">
    <node name="image_view"
          pkg="image_view" type="image_view"
          clear_params="true">
      <remap from="image" to="image_rect_color" />
      <rosparam subst_value="true">
        gui: $(arg GUI)
      </rosparam>
    </node>
  </group>

  <group ns="/camera/aligned_depth_to_color">
    <node name="image_view"
          pkg="image_view" type="image_view"
          clear_params="true">
      <remap from="image" to="image_raw" />
      <rosparam subst_value="true">
        colormap: 2
        do_dynamic_scaling: true
        gui: $(arg GUI)
      </rosparam>
    </node>
  </group>

  <group ns="camera">
    <group if="$(arg PLAY_ROSBAG)">
      <node pkg="nodelet" type="nodelet" name="points_xyzrgb_aligned_depth_to_color"
            args="standalone depth_image_proc/point_cloud_xyzrgb">
        <!-- Explicit topic remappings, shouldn't need all of these -->
        <remap from="rgb/image_rect_color"        to="color/image_rect_color" />
        <remap from="rgb/camera_info"             to="color/camera_info" />
        <remap from="depth_registered/image_rect" to="aligned_depth_to_color/image_raw" />
        <remap from="depth_registered/points"     to="depth_registered/points" />
      </node>
    </group>
    <node name="bilateral_filter"
          pkg="nodelet" type="nodelet"
          args="standalone jsk_pcl/BilateralFilter">
      <remap from="~input" to="depth_registered/points" />
    </node>
    <node name="pointcloud_to_depth_image"
          pkg="nodelet" type="nodelet"
          args="standalone jsk_pcl_utils/PointCloudToDepthImage">
      <remap from="~input" to="bilateral_filter/output" />
    </node>
  </group>


</launch>
